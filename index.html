<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slow Roads – Heavy Realism</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:#87b5ff; font-family:Inter,system-ui }
#ui {
  position:absolute; top:20px; left:20px;
  color:white; text-shadow:0 5px 20px rgba(0,0,0,.5);
}
#speed { font-size:4rem; font-weight:200 }
#unit { font-size:.8rem; opacity:.8 }
#hint {
  position:absolute; bottom:20px; width:100%;
  text-align:center; letter-spacing:3px;
  color:white; opacity:.6
}
</style>
</head>

<body>
<div id="ui">
  <div id="speed">00</div>
  <div id="unit">KM / H</div>
</div>
<div id="hint">W A S D — DRIVE • RELAX</div>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
  }
}
</script>

<script type="module">
import * as THREE from 'three';

/* ================= GLOBALS ================= */
let scene, camera, renderer, clock;
let car, sun, terrain;
let speed = 0, rot = 0;
const keys = { w:0, a:0, s:0, d:0 };
const wheels = [];

/* ================= INIT ================= */
init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87b5ff);
  scene.fog = new THREE.Fog(0x87b5ff, 200, 1800);

  camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 5000);
  camera.position.set(0, 6, 16);

  renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  document.body.appendChild(renderer.domElement);

  clock = new THREE.Clock();

  /* === LIGHTS === */
  scene.add(new THREE.AmbientLight(0xffffff, .4));

  sun = new THREE.DirectionalLight(0xffffff, 1.4);
  sun.position.set(300, 400, 300);
  sun.castShadow = true;
  sun.shadow.mapSize.set(4096, 4096);
  sun.shadow.camera.left = -600;
  sun.shadow.camera.right = 600;
  sun.shadow.camera.top = 600;
  sun.shadow.camera.bottom = -600;
  scene.add(sun);

  createTerrain();
  createCar();

  window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = 1);
  window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = 0);
  window.addEventListener('resize', onResize);
}

/* ================= TEXTURES ================= */
const loader = new THREE.TextureLoader();
const grassTex = loader.load(
  "https://threejs.org/examples/textures/terrain/grasslight-big.jpg"
);
grassTex.wrapS = grassTex.wrapT = THREE.RepeatWrapping;
grassTex.repeat.set(50,50);

const dirtTex = loader.load(
  "https://threejs.org/examples/textures/terrain/grasslight-big-nm.jpg"
);
dirtTex.wrapS = dirtTex.wrapT = THREE.RepeatWrapping;
dirtTex.repeat.set(20,20);

/* ================= TERRAIN ================= */
function createTerrain() {
  const geo = new THREE.PlaneGeometry(3000, 3000, 200, 200);
  const p = geo.attributes.position;

  for (let i = 0; i < p.count; i++) {
    const x = p.getX(i);
    const y = p.getY(i);
    const h =
      Math.sin(x * 0.004) * 30 +
      Math.cos(y * 0.004) * 30;
    p.setZ(i, h);
  }
  geo.computeVertexNormals();

  terrain = new THREE.Mesh(
    geo,
    new THREE.MeshStandardMaterial({
      map: grassTex,
      roughness: 1
    })
  );
  terrain.rotation.x = -Math.PI / 2;
  terrain.receiveShadow = true;
  scene.add(terrain);

  const road = new THREE.Mesh(
    new THREE.PlaneGeometry(20, 3000),
    new THREE.MeshStandardMaterial({
      color: 0xc2a07a,
      roughness: .9
    })
  );
  road.rotation.x = -Math.PI / 2;
  road.position.y = 0.4;
  scene.add(road);
}

/* ================= CAR ================= */
function createCar() {
  car = new THREE.Group();

  const body = new THREE.Mesh(
    new THREE.BoxGeometry(2.2, .6, 4.8),
    new THREE.MeshStandardMaterial({
      color: 0xffffff,
      metalness: .7,
      roughness: .2
    })
  );
  body.castShadow = true;
  car.add(body);

  const cabin = new THREE.Mesh(
    new THREE.BoxGeometry(1.4, .6, 2),
    new THREE.MeshStandardMaterial({ color: 0x111111 })
  );
  cabin.position.y = .55;
  cabin.castShadow = true;
  car.add(cabin);

  const wheelGeo = new THREE.CylinderGeometry(.4,.4,.3,24);
  const wheelMat = new THREE.MeshStandardMaterial({ color:0x111 });

  [[1.1,1.6],[-1.1,1.6],[1.1,-1.6],[-1.1,-1.6]].forEach(p=>{
    const w = new THREE.Mesh(wheelGeo, wheelMat);
    w.rotation.z = Math.PI/2;
    w.position.set(p[0], -.25, p[1]);
    w.castShadow = true;
    wheels.push(w);
    car.add(w);
  });

  car.position.y = 2;
  scene.add(car);
}

/* ================= UPDATE ================= */
function update(dt) {
  speed += (keys.w ? 50 : keys.s ? -70 : -20) * dt;
  speed = THREE.MathUtils.clamp(speed, 0, 140);

  if (speed > 1) {
    rot += (keys.a ? 1 : keys.d ? -1 : 0) * dt * (1 - speed / 160);
  }

  car.position.x -= Math.sin(rot) * speed * dt;
  car.position.z -= Math.cos(rot) * speed * dt;
  car.rotation.y = rot;

  wheels.forEach(w => w.rotation.x -= speed * dt);

  camera.position.lerp(
    car.position.clone().add(
      new THREE.Vector3(
        Math.sin(rot) * 18,
        8,
        Math.cos(rot) * 18
      )
    ),
    0.08
  );
  camera.lookAt(car.position.x, car.position.y + 2, car.position.z);

  document.getElementById("speed").innerText =
    Math.round(speed).toString().padStart(2, "0");
}

/* ================= LOOP ================= */
function animate() {
  requestAnimationFrame(animate);
  update(clock.getDelta());
  renderer.render(scene, camera);
}

function onResize() {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
}
</script>
</body>
</html>
